-- Extracting station coordinates

ALTER TABLE bcycle_stations
ADD COLUMN lat double precision,
ADD COLUMN long double precision;

UPDATE bcycle_stations
	SET lat = substring("Location", '30\.\d+' ) :: double precision,
		long = substring("Location", '-97\.\d+' ) :: double precision;


-- Geocode station table

ALTER TABLE bcycle_stations ADD COLUMN geom geometry(Point, 4269);
UPDATE bcycle_stations SET geom = ST_SetSRID(ST_MakePoint(long,lat), 4269);


-- Convert CRS

ALTER TABLE bcycle_stations ALTER COLUMN geom TYPE Geometry(Point, 32139) USING ST_Transform(geom, 32139);


-- Buffer 'Austin_grid', spatial join

WITH buffer AS (
	SELECT id, ST_Buffer(geom, 400) AS geom
	FROM austin_grid);